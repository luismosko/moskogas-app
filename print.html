
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Recibo ‚Äî Mosko G√°s e √Ågua</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: Arial, Helvetica, sans-serif; background: #f1f5f9; }

  .no-print {
    background: #f97316; color: #fff; border: none; padding: 12px 32px;
    font-size: 15px; font-weight: 700; cursor: pointer; border-radius: 8px;
    margin: 16px auto; display: block; width: fit-content;
  }

  .page { width: 210mm; margin: 0 auto; background: #fff; }

  /* Cada via ocupa metade da folha A4 (~148mm) */
  .via { width: 100%; padding: 8mm 12mm; }

  /* Linha de corte */
  .corte {
    border-top: 2px dashed #aaa;
    text-align: center; color: #aaa; font-size: 10px;
    padding: 3px 0; letter-spacing: 3px;
    margin: 0 12mm;
  }

  /* Cabe√ßalho */
  .header {
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 2px solid #f97316; padding-bottom: 6px; margin-bottom: 8px;
  }
  .header-left { display: flex; align-items: center; gap: 10px; }
  .logo { height: 40px; }
  .company-info { font-size: 9px; color: #555; line-height: 1.6; }
  .company-info strong { font-size: 11px; color: #1e293b; }
  .header-right { text-align: right; font-size: 10px; color: #444; line-height: 1.7; }
  .pedido-num { font-size: 18px; font-weight: 900; color: #f97316; }

  .via-label {
    display: inline-block; background: #1e293b; color: #fff;
    padding: 2px 8px; border-radius: 3px; font-size: 10px; font-weight: 700;
    margin-bottom: 4px; letter-spacing: 1px;
  }

  /* Dados do cliente ‚Äî 2 colunas */
  .section-title { font-size: 9px; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 3px; }
  .cliente-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1px 16px; margin-bottom: 7px; font-size: 11px; }
  .cliente-grid .full { grid-column: 1 / -1; }
  .lbl { font-weight: 700; color: #1e293b; }
  .obs-line { font-size: 11px; margin-bottom: 7px; }

  /* Tabela de itens */
  table { width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 6px; }
  thead th { background: #1e293b; color: #fff; padding: 4px 6px; text-align: left; }
  thead th:last-child { text-align: right; }
  td { padding: 4px 6px; border-bottom: 1px solid #e2e8f0; }
  td.num { text-align: center; }
  td.right { text-align: right; }
  .total-row td { font-weight: 700; border-top: 2px solid #1e293b; border-bottom: none; font-size: 12px; background: #f8fafc; }

  /* Bloco recebimento */
  .recebimento { border: 1.5px solid #334155; border-radius: 5px; padding: 7px 10px; margin-top: 6px; }
  .recebimento-title { font-size: 11px; font-weight: 700; text-align: center; margin-bottom: 7px; text-transform: uppercase; letter-spacing: 1px; }
  .fields-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px 14px; margin-bottom: 4px; }
  .field-label { font-size: 9px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1px; }
  .field-line { border-bottom: 1px solid #333; height: 17px; }
  .assinatura-line { border-bottom: 1px solid #333; height: 28px; margin-top: 2px; }
  .footer { font-size: 9px; color: #aaa; text-align: center; margin-top: 5px; }

  @media print {
    .no-print { display: none !important; }
    body { background: #fff; margin: 0; }
    .page { width: 100%; margin: 0; }
    @page { size: A4 portrait; margin: 0; }
  }
</style>
</head>
<body>

<button class="no-print" onclick="window.print()">üñ®Ô∏è Imprimir</button>

<div class="page" id="receipt">
  <!-- VIA 1: CLIENTE -->
  <div class="via">
    <div class="via-label">VIA CLIENTE</div>
    <div class="header">
      <div class="header-left">
        <img class="logo" src="https://moskogas.com.br/wp-content/uploads/2021/08/Logo-Moskogas-Ultragaz.png" alt="Mosko G√°s" onerror="this.style.display='none';this.nextSibling.style.display='block'">
        <div style="display:none;font-size:18px;font-weight:900;color:#f97316">üî• MOSKO G√ÅS</div>
        <div class="company-info">
          <strong>Mosko Ltda</strong> ‚Äî CNPJ 12.979.010/0011-17<br>
          Av. Panamericana, 295 ‚Äì Estrela Dalva ‚Äì Campo Grande/MS<br>
          ‚òé (67) 99333-0303 | contato@moskogas.com.br | moskogas.com.br
        </div>
      </div>
      <div class="header-right" id="hdr1"></div>
    </div>
    <div class="section-title">Dados do Cliente</div>
    <div class="cliente-grid" id="cliente1"></div>
    <div id="obs1"></div>
    <table id="table1"></table>
    <div class="recebimento">
      <div class="recebimento-title">‚úÖ Recebi o Produto em Boas Condi√ß√µes</div>
      <div class="fields-2">
        <div><div class="field-label">Nome Leg√≠vel</div><div class="field-line"></div></div>
        <div><div class="field-label">CPF</div><div class="field-line"></div></div>
        <div style="grid-column:1/-1"><div class="field-label">Data de Recebimento</div><div class="field-line"></div></div>
      </div>
      <div style="margin-top:4px">
        <div class="field-label">Assinatura</div>
        <div class="assinatura-line"></div>
      </div>
    </div>
    <div class="footer">MOSKO G√ÅS ‚Äî Obrigado pela prefer√™ncia!</div>
  </div>

  <!-- CORTE -->
  <div class="corte">‚úÇ &nbsp;‚Äî‚Äî CORTE AQUI ‚Äî‚Äî&nbsp; ‚úÇ</div>

  <!-- VIA 2: MOSKO G√ÅS ‚Äî RETORNO -->
  <div class="via">
    <div class="via-label">VIA MOSKO G√ÅS ‚Äî RETORNO ASSINADO</div>
    <div class="header">
      <div class="header-left">
        <img class="logo" src="https://moskogas.com.br/wp-content/uploads/2021/08/Logo-Moskogas-Ultragaz.png" alt="Mosko G√°s" onerror="this.style.display='none';this.nextSibling.style.display='block'">
        <div style="display:none;font-size:18px;font-weight:900;color:#f97316">üî• MOSKO G√ÅS</div>
        <div class="company-info">
          <strong>Mosko Ltda</strong> ‚Äî CNPJ 12.979.010/0011-17<br>
          Av. Panamericana, 295 ‚Äì Estrela Dalva ‚Äì Campo Grande/MS<br>
          ‚òé (67) 99333-0303 | contato@moskogas.com.br | moskogas.com.br
        </div>
      </div>
      <div class="header-right" id="hdr2"></div>
    </div>
    <div class="section-title">Dados do Cliente</div>
    <div class="cliente-grid" id="cliente2"></div>
    <div id="obs2"></div>
    <table id="table2"></table>
    <div class="recebimento">
      <div class="recebimento-title">‚úÖ Recebi o Produto em Boas Condi√ß√µes</div>
      <div class="fields-2">
        <div><div class="field-label">Nome Leg√≠vel</div><div class="field-line"></div></div>
        <div><div class="field-label">CPF</div><div class="field-line"></div></div>
        <div style="grid-column:1/-1"><div class="field-label">Data de Recebimento</div><div class="field-line"></div></div>
      </div>
      <div style="margin-top:4px">
        <div class="field-label">Assinatura</div>
        <div class="assinatura-line"></div>
      </div>
    </div>
    <div class="footer">MOSKO G√ÅS ‚Äî Obrigado pela prefer√™ncia!</div>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
let order;
try { order = JSON.parse(decodeURIComponent(params.get('data') || '{}')); } catch(e) { order = {}; }

const items = JSON.parse(order.items_json || '[]');
const hora = order.created_at
  ? new Date(order.created_at * 1000).toLocaleString('pt-BR', { timeZone: 'America/Campo_Grande', day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit' })
  : '‚Äî';
const driver = order.driver_name_cache || order.driver_name_db || '‚Äî';

function buildHeader(id) {
  document.getElementById(id).innerHTML = `
    Pedido N¬∫ <span class="pedido-num">#${order.id || '‚Äî'}</span><br>
    Data/Hora: ${hora}<br>
    Entregador: <strong>${driver}</strong>`;
}

function buildCliente(id) {
  const end = [order.address_line, order.bairro].filter(Boolean).join(' ‚Äî ') + ' ‚Äî Campo Grande/MS';
  document.getElementById(id).innerHTML = `
    <div><span class="lbl">üë§ Nome:</span> ${order.customer_name || '‚Äî'}</div>
    <div><span class="lbl">üìû Telefone:</span> ${order.phone_digits || '‚Äî'}</div>
    <div class="full"><span class="lbl">üìç Endere√ßo:</span> ${end}</div>
    ${order.complemento ? `<div><span class="lbl">Complemento:</span> ${order.complemento}</div>` : ''}
    ${order.referencia  ? `<div><span class="lbl">Refer√™ncia:</span> ${order.referencia}</div>` : ''}`;
}

function buildObs(id) {
  if (order.notes) {
    document.getElementById(id).innerHTML = `<div class="obs-line"><span class="lbl">üìù Obs:</span> ${order.notes}</div>`;
  }
}

function buildTable(id) {
  let rows = items.map(i => {
    const sub = ((i.price||0)*(i.qty||1)).toFixed(2);
    const name = i.name.length > 55 ? i.name.substring(0,55)+'‚Ä¶' : i.name;
    return `<tr>
      <td>${name}</td>
      <td class="num">${i.qty}</td>
      <td class="right">R$ ${parseFloat(i.price||0).toFixed(2)}</td>
      <td class="right">R$ ${sub}</td>
    </tr>`;
  }).join('');
  const total = items.reduce((s,i) => s + (i.price||0)*(i.qty||1), 0).toFixed(2);
  document.getElementById(id).innerHTML = `
    <thead><tr>
      <th>Produto</th><th style="text-align:center">Qtd</th>
      <th style="text-align:right">Unit</th><th style="text-align:right">Subtotal</th>
    </tr></thead>
    <tbody>${rows}</tbody>
    <tfoot><tr class="total-row">
      <td colspan="3">TOTAL</td>
      <td class="right">R$ ${total}</td>
    </tr></tfoot>`;
}

// Populate both vias
['1','2'].forEach(n => {
  buildHeader('hdr'+n);
  buildCliente('cliente'+n);
  buildObs('obs'+n);
  buildTable('table'+n);
});
</script>
</body>
</html>
